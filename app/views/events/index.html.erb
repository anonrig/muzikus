<div role="main" class="main">
    <section class="page-header">
		<div class="container">
			<div class="row">
				<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
					<ul class="breadcrumb">
						<li><%= link_to "HOME", root_path %></li>
						<li class="active">EVENTS</li>
					</ul>
				</div>
			</div>
			<div class="row">
				<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
					<div>
						<h1>Here is the list of all <strong>Muzikus</strong> events</h1>
					</div>
				</div>
			</div>
		</div>
	</section>
    <div class="container">
	<% if current_user && current_user.is_yk %>
		<%= link_to "Create New", new_event_path, class: 'pull-right' %>
	<% end %>
		<ul class="portfolio-list sort-destination" data-bind="foreach: EventList, visible: EventList().length > 0">
			<li class="col-md-4 isotope-item brands">
				<div class="portfolio-item">
					<a data-toggle="modal" data-target="#noAnimModal" data-bind="click: $parent.getSelectedEvent">
						<span class="thumb-info thumb-info-lighten">
							<span class="thumb-info-wrapper">
								<img data-bind="attr: {src: photo_url}" class="img-responsive" alt="">
								<span class="thumb-info-title">
									<span class="thumb-info-inner" data-bind="text: title"></span>
								</span>
							</span>
						</span>
					</a>
				</div>
			</li>
		</ul>
    </div>
</div>
<div class="modal" id="noAnimModal" tabindex="-1" role="dialog" aria-labelledby="" aria-hidden="true">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
			</div>
			<div class="modal-body">
				<div class="row mb-xl">
					<div class="col-md-4">
						<span class="img-thumbnail">
							<img alt="" class="img-responsive" data-bind="attr: {src: SelectedEvent().photo_url()}">
						</span>
					</div>

					<div class="col-md-8">

						<div class="portfolio-info">
							<div class="row">
								<div class="col-md-12 center">
									<ul>
										<li data-bind="html: '<i class=\'fa fa-calendar\'></i>' + SelectedEvent().starts_at()">
										</li>
									</ul>
								</div>
							</div>
						</div>

						<h5 class="mt-sm" data-bind="text: SelectedEvent().title()"></h5>
						<div data-bind="html: SelectedEvent().details()"></div>

						<ul class="portfolio-details">
							<li>
								<h5 class="mt-sm mb-xs">Location</h5>
								<p data-bind="text: SelectedEvent().location()"></p>
							</li>
						</ul>
						<% if current_user && current_user.is_yk %>
						<div class="modal-footer">
							<a class="btn btn-default" data-bind="attr: {href: editPath()}">Edit</a>
						</div>
						<% end %>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<script src="/vendor/momentjs/moment.js"></script>
<script src="/js/knockout-3.4.2.js"></script>
<script>
	function Event(data = {}){
		var self = this;

		this.id = ko.observable(data.id);
		this.title = ko.observable(data.title);
		this.location = ko.observable(data.location);
		this.starts_at = ko.observable(moment(data.starts_at).format('ddd, DD MMM - HH:mm'));
		this.details = ko.observable(data.details);
		this.photo_url = ko.observable(data.photo_url);
	}

	function EventViewModel(){
		var self = this;

		this.EventList = ko.observableArray([]);
		this.SelectedEvent = ko.observable(new Event());
		
		this.getSelectedEvent = function(event){
			self.SelectedEvent(event)
		}

		this.editPath = ko.pureComputed(function(){
			return `/events/${self.SelectedEvent().id()}/edit`
		})
		
		$.getJSON('/events/getAll', function(data){
			var mappedEvents = $.map(data, function(item){ return new Event(item) });
			self.EventList(mappedEvents);
		});
	}

	ko.applyBindings(new EventViewModel());
</script>

